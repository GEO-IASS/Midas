<?php 
/*=========================================================================
MIDAS Server
Copyright (c) Kitware SAS. 20 rue de la Villette. All rights reserved.
69328 Lyon, FRANCE.

See Copyright.txt for details.
This software is distributed WITHOUT ANY WARRANTY; without even
the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR
PURPOSE.  See the above copyright notices for more information.
=========================================================================*/
?>
<link type="text/css" rel="stylesheet" href="<?php echo $this->coreWebroot?>/public/css/common/common.genericPage.css" />
<link type="text/css" rel="stylesheet" href="<?php echo $this->coreWebroot?>/public/css/item/item.view.css" />
<link type="text/css" rel="stylesheet" href="<?php echo $this->coreWebroot?>/public/css/common/common.browser.css" />

<?php
$this->headScript()->appendFile($this->coreWebroot . '/public/js/item/item.view.js');
?>
<div class="viewMain">
  <div class="genericThumbnail">
  <?php
    echo "<img src='{$this->coreWebroot}/public/images/icons/document-big.png' alt=''/>";
  ?>
  </div>
  <div class="genericInfo">
    <div class="genericName"><?php   echo $this->slicename($this->itemDao->getName(),50);  ?></div>
    <div class="genericCompany"><?php echo $this->itemSize;?></div>
    <div class="itemStats"><?php echo $this->itemDao->getView()?> <?php echo $this->t('views'); ?>, 
    <?php echo $this->itemDao->getDownload()?> <?php echo $this->t('downloads');?></div>  
  </div>
  
  <table id="browseTable" class="midasTree">
    <thead>
      <tr>
        <th ><?php echo $this->t('Revision');?></th>
        <th ><?php echo $this->t('Uploaded');?></th>
        <th ><?php echo $this->t('Changes');?></th>
      </tr>
    </thead>
    <tbody>
      <?php
      $node=1;
      foreach($this->itemDao->revisions as $revision)
        {
        echo "<tr>";
        echo "  <td ><a href='{$this->webroot}/download/?items={$this->itemDao->getKey()},{$revision->getRevision()}'>Revision {$revision->getRevision()}</a></td>";
        echo "  <td>{$this->Date->ago($revision->getDate(),false)} {$this->t('by')} {$this->linkuser($revision->getUser())} </td>";
        echo "  <td>{$revision->getChanges()}</td>";
        echo "</tr>";
        $node++;
        }  
      ?>        
    </tbody>
  </table>
  
  <h4 style="margin-bottom: 5px;"><?php echo $this->t('Latest revision metadata')?>:</h4>

  <?php if(count($this->metadatavalues) == 0)
    {
    echo "No metadata for this revision.";  
    }
  else 
    {  
  ?>
  <table id="metadataTable" class="midasTree">
    <thead>
      <tr>
        <th ><?php echo $this->t('Element');?></th>
        <th ><?php echo $this->t('Qualifier');?></th>
        <th ><?php echo $this->t('Value');?></th>
      </tr>
    </thead>
    <tbody>
      <?php
      foreach($this->metadatavalues as $metadata)
        {
        echo "<tr>";
        echo "  <td>".$metadata->getElement()."</td>";
        echo "  <td>".$metadata->getQualifier()."</td>";
        echo "  <td>".$metadata->getValue()."</td>";
        echo "</tr>";
        }  
      ?>        
    </tbody>
  </table>
  <?php } ?>
  
  <h4 style="margin-bottom: 5px;"><?php echo $this->t('Latest revision content')?>:</h4>
  
  <table id="browseTable" class="midasTree">
    <thead>
      <tr>
        <th ><?php echo $this->t('Name');?></th>
        <th ><?php echo $this->t('Size');?></th>
        <th ><?php echo $this->t('Type');?></th>
      </tr>
    </thead>
    <tbody>
      <?php
      $bitstreams=$this->itemDao->lastrevision->getBitstreams();
      foreach($bitstreams as $bitstream)
        {
        echo "<tr>";
        echo "  <td>{$this->slicename($bitstream->getName(),50)}</td>";
        echo "  <td>{$this->Utility->formatSize($bitstream->getSizebytes())}  </td>";
        echo "  <td>{$bitstream->getMimetype()}</td>";
        echo "</tr>";
        }  
      ?>        
    </tbody>
  </table>
  
</div>
<div class="viewSideBar">
  <div class="sideElementFirst viewAction">
    <h1>Actions</h1>
    <ul>
      <?php 
      echo 
     "<li>
        <a  href='{$this->webroot}/download/?items={$this->itemDao->getKey()}'>";
      if($this->itemIsLink)
        {
        echo $this->t('View as weblink');  
        }
      else
        {
        echo $this->t('Download lastest revision');  
        }
      echo "</a>
      </li>        
        ";
      if($this->preview)
        {
     echo 
     "<li>
        <a id='itemPreviewLink'>{$this->t('Preview')}</a>
      </li>        
        ";
        }
      if($this->isModerator)
        {
        echo 
       "<li>
          <a href='javascript:;' class='moveCopyLink' >{$this->t('Copy')}</a>
        </li>        
        <li>
          <a href='javascript:;' type='item' element='{$this->itemDao->getKey()}' class='sharingLink' >{$this->t('Sharing settings')}</a>
        </li>        
        <li>
          <a href='javascript:;' type='item' element='{$this->itemDao->getKey()}' class='uploadRevisionLink' >{$this->t('Upload new Revision')}</a>
        </li>        
          ";
        }
      if($this->isAdmin)
        {
        echo 
       "
        <li>
          <a  href='javascript:;' id='itemDeleteLink'>{$this->t('Delete')}</a>
        </li>   
          ";
        }
      ?>
    </ul>
  </div>
  <div class="sideElementLast viewInfo">
    <h1>Info</h1>    
    <table>  
      <tbody>
        <tr>    
          <td><?php echo $this->t('Created')?></td>
          <td><?php echo $this->itemDao->creation?></td> 
        </tr>
        <tr>   
          <td><?php echo $this->t('Uploaded by');?></td>  
          <td><?php echo $this->linkuser($this->itemDao->lastrevision->getUser())?></td>
        </tr>
        <tr> 
          <td>Revision</td>   
          <td><?php echo $this->itemDao->lastrevision->getRevision()?></td>
        </tr>
        <tr>   
          <td><?php echo $this->t('Files');?></td>
          <td><?php echo count($this->itemDao->lastrevision->getBitstreams())?></td> 
        </tr>
      </tbody>
    </table>
    <?php
    $path=$this->itemDao->getThumbnail();
    if(!empty($path)&&  file_exists(BASE_PATH.'/'.$path))
      {
      echo "
        <h1>{$this->t('Preview')}</h1>
        <img class='infoLogo' alt='' src='{$this->webroot}/{$path}'/>
        ";
      }
      ?>
  </div>
</div>




